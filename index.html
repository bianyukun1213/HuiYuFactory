<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="cache-control" content="max-age=0">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
    <meta http-equiv="pragma" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="author" content="Hollis">
    <meta name="robots" content="none">
    <link rel="shortcut icon" href="favicon.ico">
    <title>U.P.G.</title>
</head>

<body onload="load()" onselectstart="return false">
    <div id="root">
        <button id="panel-control" style="position:fixed;top:5px;left:10px;z-index:4"
            onclick="hidePanel()">隐藏面板</button>
        <div id="functions"
            style="position:fixed;top:0;bottom:0;width:350px;z-index:3;overflow:auto;background-color:white;border:3px solid;opacity:0.75">
            <h1 style="margin-left:15px;margin-right:15px;margin-bottom:15px">U.P.G.</span></h1>
            <p style="margin-left:15px;margin-right:15px;margin-bottom:15px;color:red">禁止滥用，使用即同意不外传并承担一切责任与后果。</p>
            <hr style="margin-left:15px;margin-right:15px;margin-bottom:15px">
            <label for="background-input"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">背景：</label>
            <input id="background-input" type="file" accept="image/*"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px"
                oninput="loadBackgroundImg(event)">
            <hr style="margin-left:15px;margin-right:15px;margin-bottom:15px">
            <label for="signature-selection"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">签名：</label>
            <select id="signature-selection" style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px"
                oninput="selectSignature(event)">
            </select>
            <label for="signature-input"
                style="display:none;margin-left:15px;margin-right:15px;margin-bottom:15px">签名：</label>
            <input id="signature-input" type="file" accept="image/*"
                style="display:none;margin-left:15px;margin-right:15px;margin-bottom:15px"
                oninput="loadSignatureImg(event)">
            <div style="display:block">
                <label for="signature-dyeing" style="display:none;margin-bottom:15px">染色：</label>
                <input id="signature-dyeing" type="checkbox" style="margin-left:15px;margin-bottom:15px"
                    oninput="setSignatureDyeing()">
                <label for="signature-color" style="margin-bottom:15px">染色：</label>
                <input id="signature-color" type="color" disabled style="margin-right:15px;margin-bottom:15px"
                    oninput="setSignatureDyeing()">
            </div>
            <label for="signature-width"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">宽度：</label>
            <div style="display:block">
                <input id="signature-width" type="range" min="0.5" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignatureWidth()">
                <button id="reset-signature-width" style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignatureWidth()">重置</button>
            </div>
            <label for="signature-height"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">高度：</label>
            <div style="display:block">
                <input id="signature-height" type="range" disabled min="0.5" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignatureHeight()">
                <button id="reset-signature-height" disabled
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignatureHeight()">重置</button>
            </div>
            <div style="display:block">
                <input id="signature-aspect-ratio-lock" type="checkbox" checked="checked"
                    style="margin-left:15px;margin-bottom:15px" oninput="setSignatureAspectRatioLock()">
                <label for="signature-aspect-ratio-lock" style="margin-right:15px;margin-bottom:15px">锁定比例</label>
            </div>
            <label for="signature-position-x"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">位置 X：</label>
            <div style="display:block">
                <input id="signature-position-x" type="range" min="0" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignaturePositionX()">
                <button id="reset-signature-position-x" style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignaturePositionX()">重置</button>
            </div>
            <label for="signature-position-y"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">位置 Y：</label>
            <div style="display:block">
                <input id="signature-position-y" type="range" min="0" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignaturePositionY()">
                <button id="reset-signature-position-y" style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignaturePositionY()">重置</button>
            </div>
            <label for="signature-rotation-3d-x"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">三维旋转度 X：</label>
            <div style="display:block">
                <input id="signature-rotation-3d-x" type="range" min="-1" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignatureRotation3DX()">
                <button id="reset-signature-rotation-3d-x" style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignatureRotation3DX()">重置</button>
            </div>
            <label for="signature-rotation-3d-y"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">三维旋转度 Y：</label>
            <div style="display:block">
                <input id="signature-rotation-3d-y" type="range" min="-1" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignatureRotation3DY()">
                <button id="reset-signature-rotation-3d-y" style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignatureRotation3DY()">重置</button>
            </div>
            <label for="signature-rotation-3d-z"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">三维旋转度 Z：</label>
            <div style="display:block">
                <input id="signature-rotation-3d-z" type="range" min="-1" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignatureRotation3DZ()">
                <button id="reset-signature-rotation-3d-z" style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignatureRotation3DZ()">重置</button>
            </div>
            <label for="signature-opacity"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">不透明度：</label>
            <div style="display:block">
                <input id="signature-opacity" type="range" min="0.5" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignatureOpacity()">
                <button id="reset-signature-opacity" style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignatureOpacity()">重置</button>
            </div>
            <label for="signature-blur"
                style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px">模糊度：</label>
            <div style="display:block">
                <input id="signature-blur" type="range" min="0" max="1" step="0.01"
                    style="margin-left:15px;margin-right:15px;margin-bottom:15px" oninput="setSignatureBlur()">
                <button id="reset-signature-blur" style="margin-left:15px;margin-right:15px;margin-bottom:15px"
                    onclick="resetSignatureBlur()">重置</button>
            </div>
            <hr style="margin-left:15px;margin-right:15px;margin-bottom:15px">
            <button id="download" style="display:block;margin-left:15px;margin-right:15px;margin-bottom:15px"
                onclick="download()">生成图像</button>
        </div>
        <div id="content" style="position:relative">
            <div id="background" style="position:absolute;z-index:1;width:800px;border:3px solid">
                <img id="background-image" src="background.webp" alt="Background" style="width:100%">
            </div>
            <div id="signature" style="position:absolute;z-index:2;mix-blend-mode:multiply;border:3px solid">
                <img id="signature-image" alt="Signature" style="width:100%;height:100%">
            </div>
        </div>
    </div>
    <script type="text/javascript" src="https://cdn.staticfile.org/dom-to-image/2.6.0/dom-to-image.min.js">
    </script>
    <script type="text/javascript">
        let signatureData = [{
                type: 'built-in',
                image: 'signature-only-1.webp',
                text: '单签名 1',
                width: 320,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-only-2.webp',
                text: '单签名 2',
                width: 320,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-only-3.webp',
                text: '单签名 3',
                width: 320,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-1.webp',
                text: '“同意”及签名 1',
                width: 320,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-2.webp',
                text: '“同意”及签名 2',
                width: 320,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-3.webp',
                text: '“同意”及签名 3',
                width: 320,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-4.webp',
                text: '“同意”及签名 4',
                width: 200,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-5.webp',
                text: '“同意”及签名 5',
                width: 320,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-6.webp',
                text: '“情况属实。”及签名',
                width: 320,
                height: 200
            },
            {
                type: 'built-in',
                image: 'signature-7.webp',
                text: '“同意，情况属实。”及签名',
                width: 560,
                height: 160
            },
            {
                type: 'customized',
                image: 'signature-customized.webp',
                text: '自定义（320 像素 * 200 像素，白底黑字）',
                width: 320,
                height: 200
            }
        ];
        let panelHidden = false;
        let select = document.getElementById('signature-selection');
        for (let item of signatureData) {
            select.options.add(new Option(item.text));
        }
        select.selectedIndex = 0;
        let signatureWidth = signatureData[0].width;
        let signatureHeight = signatureData[0].height;
        let signatureTransform = {
            rotation3DX: 0,
            rotation3DY: 0,
            rotation3DZ: 0
        };
        document.getElementById('signature-image').src = signatureData[0].image;
        window.onresize = function () {
            setSignatureWidth();
            setSignatureHeight();
        };
        document.getElementById('background-image').onload = function () {
            setSignatureWidth();
            setSignatureHeight();
        };
        document.getElementById('signature-image').onload = function () {
            let index = document.getElementById('signature-selection').options.selectedIndex;
            signatureWidth = signatureData[index].width;
            signatureHeight = signatureData[index].height;
            setSignatureWidth();
            setSignatureHeight();
            setSignatureDyeing();
        };
        let load = function () {
            resetSignatureWidth();
            resetSignatureHeight();
            resetSignaturePositionX();
            resetSignaturePositionY();
            resetSignatureRotation3DX();
            resetSignatureRotation3DY();
            resetSignatureRotation3DZ();
            resetSignatureOpacity();
            resetSignatureBlur();
        };
        let hidePanel = function () {
            panelHidden = !panelHidden;
            document.getElementById('functions').hidden = panelHidden;
            if (panelHidden)
                document.getElementById('panel-control').innerText = '显示面板';
            else
                document.getElementById('panel-control').innerText = '隐藏面板';
        };
        let loadBackgroundImg = function (event) {
            if (event.target.files.length === 0)
                return;
            let output = document.getElementById('background-image');
            URL.revokeObjectURL(output.src);
            output.src = URL.createObjectURL(event.target.files[0]);
        };
        let loadSignatureImg = function (event) {
            if (event.target.files.length === 0)
                return;
            let output = document.getElementById('signature-image');
            URL.revokeObjectURL(output.src);
            signatureData[Object.keys(signatureData).length - 1].image = URL.createObjectURL(event.target.files[0]);
            output.src = URL.createObjectURL(event.target.files[0]);
        };
        let selectSignature = function (event) {
            let index = event.target.options.selectedIndex;
            document.getElementById('signature-image').src = signatureData[index].image;
            if (signatureData[index].type == 'customized')
                document.getElementById('signature-input').style.display = 'block';
            else
                document.getElementById('signature-input').style.display = 'none';
        };
        let setSignatureWidth = function () {
            let locked = document.getElementById('signature-aspect-ratio-lock').checked;
            let value = document.getElementById('signature-width').value;
            let signature = document.getElementById('signature');
            signature.style.width = (signatureWidth * value) + 'px';
            if (locked) {
                document.getElementById('signature-height').value = value;
                signature.style.height = (signatureHeight * value) + 'px';
            }
            setSignaturePositionX();
            setSignaturePositionY();
        };
        let resetSignatureWidth = function () {
            document.getElementById('signature-width').value = 1;
            setSignatureWidth();
        };
        let setSignatureHeight = function () {
            let value = document.getElementById('signature-height').value;
            let signature = document.getElementById('signature');
            signature.style.height = (signatureHeight * value) + 'px';
            setSignaturePositionX();
            setSignaturePositionY();
        };
        let resetSignatureHeight = function () {
            document.getElementById('signature-height').value = 1;
            setSignatureHeight();
        };
        let setSignatureAspectRatioLock = function () {
            if (document.getElementById('signature-aspect-ratio-lock').checked) {
                document.getElementById('signature-height').disabled = true;
                document.getElementById('reset-signature-height').disabled = true;
            } else {
                document.getElementById('signature-height').disabled = false;
                document.getElementById('reset-signature-height').disabled = false;
            }
            setSignatureWidth();
            setSignatureHeight();
        };
        let setSignaturePositionX = function () {
            let value = document.getElementById('signature-position-x').value;
            let signature = document.getElementById('signature');
            let backgroundOffsetLeft = document.getElementById('background').offsetLeft;
            let backgroundWidth = document.getElementById('background').offsetWidth;
            let xLimitation = backgroundWidth - signature.offsetWidth;
            signature.style.left = (backgroundOffsetLeft + xLimitation * value) + 'px';
        };
        let resetSignaturePositionX = function () {
            document.getElementById('signature-position-x').value = 0.8;
            setSignaturePositionX();
        };
        let setSignaturePositionY = function () {
            let value = document.getElementById('signature-position-y').value;
            let signature = document.getElementById('signature');
            let backgroundOffsetTop = document.getElementById('background').offsetTop;
            let backgroundHeight = document.getElementById('background').offsetHeight;
            let yLimitation = backgroundHeight - signature.offsetHeight;
            signature.style.top = (backgroundOffsetTop + yLimitation * value) + 'px';
        };
        let resetSignaturePositionY = function () {
            document.getElementById('signature-position-y').value = 0.8;
            setSignaturePositionY();
        };
        let setSignatureRotation3DX = function () {
            let value = document.getElementById('signature-rotation-3d-x').value;
            signatureTransform.rotation3DX = 15 * value;
            applySignatureRotation();
        };
        let resetSignatureRotation3DX = function () {
            document.getElementById('signature-rotation-3d-x').value = 0;
            setSignatureRotation3DX();
        };
        let setSignatureRotation3DY = function () {
            let value = document.getElementById('signature-rotation-3d-y').value;
            signatureTransform.rotation3DY = 15 * value;
            applySignatureRotation();
        };
        let resetSignatureRotation3DY = function () {
            document.getElementById('signature-rotation-3d-y').value = 0;
            setSignatureRotation3DY();
        };
        let setSignatureRotation3DZ = function () {
            let value = document.getElementById('signature-rotation-3d-z').value;
            signatureTransform.rotation3DZ = 15 * value;
            applySignatureRotation();
        };
        let resetSignatureRotation3DZ = function () {
            document.getElementById('signature-rotation-3d-z').value = 0;
            setSignatureRotation3DZ();
        };
        let applySignatureRotation = function () {
            let signature = document.getElementById('signature');
            signature.style.transform = 'perspective(100px) rotateX(' + signatureTransform.rotation3DX +
                'deg) rotateY(' + signatureTransform
                .rotation3DY + 'deg) rotateZ(' + signatureTransform.rotation3DZ + 'deg)';
        };
        let setSignatureOpacity = function () {
            let value = document.getElementById('signature-opacity').value;
            let signature = document.getElementById('signature');
            signature.style.opacity = value;
        };
        let resetSignatureOpacity = function () {
            document.getElementById('signature-opacity').value = 1;
            setSignatureOpacity();
        };
        let setSignatureBlur = function () {
            let value = document.getElementById('signature-blur').value;
            let signature = document.getElementById('signature');
            signature.style.filter = 'blur(' + 1.5 * value + 'px)';
        };
        let resetSignatureBlur = function () {
            document.getElementById('signature-blur').value = 0;
            setSignatureBlur();
        };
        let setSignatureDyeing = function () {
            let signature = document.getElementById('signature');
            let image = document.getElementById('signature-image');
            if (document.getElementById('signature-dyeing').checked) {
                let value = document.getElementById('signature-color').value;
                document.getElementById('signature-color').disabled = false;
                signature.style.backgroundImage = 'url(' + image.src + '),linear-gradient(' + value + ',' + value +
                    ')';
                signature.style.backgroundSize = '100% 100%';
                signature.style.backgroundRepeat = 'no-repeat';
                signature.style.backgroundBlendMode = 'lighten';
                image.hidden = true;
            } else {
                document.getElementById('signature-color').disabled = true;
                signature.style.backgroundImage = '';
                signature.style.backgroundSize = '';
                signature.style.backgroundRepeat = '';
                signature.style.backgroundBlendMode = '';
                image.hidden = false;
            }
        };
        let download = function () {
            let background = document.getElementById('background');
            let signature = document.getElementById('signature');
            background.style.border = '';
            signature.style.border = '';
            let node = document.getElementById('content');
            domtoimage.toJpeg(node, {
                width: document.getElementById('background-image').offsetWidth,
                height: document.getElementById('background-image').offsetHeight
            }).then(function (dataUrl) {
                let a = document.createElement('a');
                a.href = dataUrl;
                a.download = 'picture.jpg';
                a.click();
                background.style.border = '3px solid';
                signature.style.border = '3px solid';
            });
        };
    </script>
</body>

</html>